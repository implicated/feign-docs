<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Spring 整合 Feign 原理 :: Implicated</title>
    <link rel="canonical" href="https://docs.implicated.com/open-feign/spring-cloud-open-feign/spring-feign-integrations.html">
    <link rel="prev" href="../feign/feign-core.html">
    <link rel="next" href="spring-mvc-support.html">
    <meta name="generator" content="Antora 3.1.2">
    <link rel="stylesheet" href="../../_/css/site.css">
    <script>var uiRootPath = '../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://docs.implicated.com">Implicated</a>
      <div class="navbar-item search hide-for-print">
        <div id="search-field" class="field">
          <input id="search-input" type="text" placeholder="Search the docs">
        </div>
      </div>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
<!--    <div id="topbar-nav" class="navbar-menu">-->
<!--      <div class="navbar-end">-->
<!--        <a class="navbar-item" href="#">Home</a>-->
<!--        <div class="navbar-item has-dropdown is-hoverable">-->
<!--          <a class="navbar-link" href="#">Products</a>-->
<!--          <div class="navbar-dropdown">-->
<!--            <a class="navbar-item" href="#">Product A</a>-->
<!--            <a class="navbar-item" href="#">Product B</a>-->
<!--            <a class="navbar-item" href="#">Product C</a>-->
<!--          </div>-->
<!--        </div>-->
<!--        <div class="navbar-item has-dropdown is-hoverable">-->
<!--          <a class="navbar-link" href="#">Services</a>-->
<!--          <div class="navbar-dropdown">-->
<!--            <a class="navbar-item" href="#">Service A</a>-->
<!--            <a class="navbar-item" href="#">Service B</a>-->
<!--            <a class="navbar-item" href="#">Service C</a>-->
<!--          </div>-->
<!--        </div>-->
<!--        <div class="navbar-item">-->
<!--          <span class="control">-->
<!--            <a class="button is-primary" href="#">Download</a>-->
<!--          </span>-->
<!--        </div>-->
<!--      </div>-->
<!--    </div>-->
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="open-feign" data-version="">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">Learn OpenFeign</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../introduction.html">基本介绍</a>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Feign</span>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../feign/feign-component.html">Feign 的组成</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="../feign/feign-core.html">Feign 的核心流程</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <span class="nav-text">Spring Cloud Open Feign</span>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="spring-feign-integrations.html">Spring 整合 Feign 原理</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spring-mvc-support.html">SpringMVC 注解支持原理</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="spring-feign-configuration.html">Spring Cloud Open Feign 配置项</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../optimize.html">Open Feign 的性能优化</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../future.html">Feign 的未来</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../ref.html">参考文档</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<!--<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Learn OpenFeign</span>
    <span class="version">default</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">Learn OpenFeign</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">default</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
-->
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">Learn OpenFeign</a></li>
    <li>Spring Cloud Open Feign</li>
    <li><a href="spring-feign-integrations.html">Spring 整合 Feign 原理</a></li>
  </ul>
</nav>
<!---->
<!--  -->
<!--  <div class="edit-this-page"><a href="https://github.com/implicated/feign-docs/edit/master/docs/modules/ROOT/pages/spring-cloud-open-feign/spring-feign-integrations.adoc">Edit this Page</a></div>-->
<!--  -->
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">Spring 整合 Feign 原理</h1>
<div id="preamble">
<div class="sectionbody">
<div class="paragraph">
<p>基本流程：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>使用 <code>FeignClientsRegistrar</code> 扫包并</p>
<div class="ulist">
<ul>
<li>
<p>注入 <code>FeignClient</code> 配置信息（实际是注入 <code>FeignClientSpecification</code>）。</p>
</li>
<li>
<p>注入 <code>FeignClient</code> 客户端（实际是注入 <code>FeignClientFactoryBean</code>）。</p>
</li>
</ul>
</div>
</li>
<li>
<p>使用 <code>FeignClientSpecification</code> 和 <code>FeignClientFactoryBean</code> 为每个 <code>@FeignClient</code> 标记的类创建子容器，每个容器相互隔离，都拥有完整的 <code>FeignClient</code> 配置信息。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>核心类：</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">FeignClientSpecification</th>
<th class="tableblock halign-left valign-top">FeignClientFactoryBean</th>
<th class="tableblock halign-left valign-top">FeignContext</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><div class="content"><div class="imageblock">
<div class="content">
<img src="../_images/feign-client-specification.png" alt="feign client specification">
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="imageblock">
<div class="content">
<img src="../_images/feign-client-factory-bean.png" alt="feign client factory bean">
</div>
</div></div></td>
<td class="tableblock halign-left valign-top"><div class="content"><div class="imageblock">
<div class="content">
<img src="../_images/feign-context.png" alt="feign context">
</div>
</div></div></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect1">
<h2 id="时序图"><a class="anchor" href="#时序图"></a>时序图</h2>
<div class="sectionbody">
<div class="imageblock kroki">
<div class="content">
<img src="../_images/diag-abd63f00931520084486303f26e09cb703eb7eba.svg" alt="Diagram">
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="入口"><a class="anchor" href="#入口"></a>入口</h2>
<div class="sectionbody">
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title"><code>org.springframework.cloud.openfeign.EnableFeignClients</code></div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-meta">@Retention()</span>
<span class="hljs-meta">@Target(ElementType.TYPE)</span>
<span class="hljs-meta">@Documented</span>
<span class="hljs-meta">@Import(FeignClientsRegistrar.class)</span> <i class="conum" data-value="1"></i><b>(1)</b>
<span class="hljs-keyword">public</span> <span class="hljs-meta">@interface</span> EnableFeignClients {
   <span class="hljs-comment">// ...</span>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>导入 FeignClient 注入器</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="feignclient-注入器"><a class="anchor" href="#feignclient-注入器"></a>FeignClient 注入器</h2>
<div class="sectionbody">
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">org.springframework.cloud.openfeign.FeignClientsRegistrar</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerBeanDefinitions</span><span class="hljs-params">(AnnotationMetadata metadata, BeanDefinitionRegistry registry)</span> {
    registerDefaultConfiguration(metadata, registry); <i class="conum" data-value="1"></i><b>(1)</b>
    registerFeignClients(metadata, registry); <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>注入 <code>@EnableFeignClients</code> 的全局默认配置（defaultConfiguration）</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>注入 <code>@FeignClient</code></td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="注入-enablefeignclients"><a class="anchor" href="#注入-enablefeignclients"></a>注入 <code>@EnableFeignClients</code></h3>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">org.springframework.cloud.openfeign.FeignClientsRegistrar#registerDefaultConfiguration</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerClientConfiguration</span><span class="hljs-params">(BeanDefinitionRegistry registry, Object name,
            Object configuration)</span> {
    <span class="hljs-type">BeanDefinitionBuilder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> BeanDefinitionBuilder
            .genericBeanDefinition(FeignClientSpecification.class);
    builder.addConstructorArgValue(name);
    builder.addConstructorArgValue(configuration);
    <span class="hljs-comment">// 注入 FeignClientSpecification （包含 ）EnableFeignClients.defaultConfiguration</span>
    registry.registerBeanDefinition(
            name + <span class="hljs-string">&quot;.&quot;</span> + FeignClientSpecification.class.getSimpleName(),
            builder.getBeanDefinition());
    }</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="注入-feignclient"><a class="anchor" href="#注入-feignclient"></a>注入 <code>@FeignClient</code></h3>
<div class="listingblock">
<div class="title">org.springframework.cloud.openfeign.FeignClientsRegistrar#registerFeignClients</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerFeignClients</span><span class="hljs-params">(AnnotationMetadata metadata, BeanDefinitionRegistry registry)</span> {
    <span class="hljs-comment">// 获取ClassPath扫描器</span>
    <span class="hljs-type">ClassPathScanningCandidateComponentProvider</span> <span class="hljs-variable">scanner</span> <span class="hljs-operator">=</span> getScanner();
    <span class="hljs-comment">// 为扫描器设置资源加载器</span>
    scanner.setResourceLoader(<span class="hljs-built_in">this</span>.resourceLoader);

    Set&lt;String&gt; basePackages;

    <span class="hljs-comment">// 获取 @EnableFeignClients 注解的属性 map</span>
    Map&lt;String, Object&gt; attrs = metadata
            .getAnnotationAttributes(EnableFeignClients.class.getName());
    <span class="hljs-type">AnnotationTypeFilter</span> <span class="hljs-variable">annotationTypeFilter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AnnotationTypeFilter</span>(
            FeignClient.class);
    <span class="hljs-comment">// 获取 @EnableFeignClients 注解的 clients 属性</span>
    <span class="hljs-keyword">final</span> Class&lt;?&gt;[] clients = attrs == <span class="hljs-literal">null</span> ? <span class="hljs-literal">null</span>
            : (Class&lt;?&gt;[]) attrs.get(<span class="hljs-string">&quot;clients&quot;</span>);
    <span class="hljs-comment">// 如果 @EnableFeignClients 注解未指定 clients 属性则扫描添加（扫描过滤条件为：标记有 @FeignClient 的类）</span>
    <span class="hljs-keyword">if</span> (clients == <span class="hljs-literal">null</span> || clients.length == <span class="hljs-number">0</span>) {
        scanner.addIncludeFilter(annotationTypeFilter);
        basePackages = getBasePackages(metadata);
    }
    <span class="hljs-comment">// 如果 @EnableFeignClients 注解已指定 clients 属性，则直接添加，不再扫描（从这里可以看出，为了加快容器启动速度，建议都指定 clients 属性）</span>
    <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">final</span> Set&lt;String&gt; clientClasses = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();
        basePackages = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();
        <span class="hljs-comment">// 扫描 clients</span>
        <span class="hljs-keyword">for</span> (Class&lt;?&gt; clazz : clients) {
            basePackages.add(ClassUtils.getPackageName(clazz));
            clientClasses.add(clazz.getCanonicalName());
        }
        <span class="hljs-comment">// 过滤标记有 @FeignClient 的类</span>
        <span class="hljs-type">AbstractClassTestingTypeFilter</span> <span class="hljs-variable">filter</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">AbstractClassTestingTypeFilter</span>() {
            <span class="hljs-meta">@Override</span>
            <span class="hljs-keyword">protected</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">match</span><span class="hljs-params">(ClassMetadata metadata)</span> {
                <span class="hljs-type">String</span> <span class="hljs-variable">cleaned</span> <span class="hljs-operator">=</span> metadata.getClassName().replaceAll(<span class="hljs-string">&quot;\\$&quot;</span>, <span class="hljs-string">&quot;.&quot;</span>);
                <span class="hljs-keyword">return</span> clientClasses.contains(cleaned);
            }
        };
        <span class="hljs-comment">// 同时满足</span>
        scanner.addIncludeFilter(
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">AllTypeFilter</span>(Arrays.asList(filter, annotationTypeFilter)));
    }

    <span class="hljs-comment">// 遍历最终获取到的 @FeignClient 注解类的集合</span>
    <span class="hljs-keyword">for</span> (String basePackage : basePackages) {
        Set&lt;BeanDefinition&gt; candidateComponents = scanner
                .findCandidateComponents(basePackage);
        <span class="hljs-keyword">for</span> (BeanDefinition candidateComponent : candidateComponents) {
            <span class="hljs-comment">// 判断是否是带有注解的 Bean</span>
            <span class="hljs-keyword">if</span> (candidateComponent <span class="hljs-keyword">instanceof</span> AnnotatedBeanDefinition) {
                <span class="hljs-comment">// 验证带注释的类必须是接口，不是接口则直接抛出异常</span>
                <span class="hljs-comment">// verify annotated class is an interface</span>
                <span class="hljs-type">AnnotatedBeanDefinition</span> <span class="hljs-variable">beanDefinition</span> <span class="hljs-operator">=</span> (AnnotatedBeanDefinition) candidateComponent;
                <span class="hljs-type">AnnotationMetadata</span> <span class="hljs-variable">annotationMetadata</span> <span class="hljs-operator">=</span> beanDefinition.getMetadata();
                Assert.isTrue(annotationMetadata.isInterface(),
                        <span class="hljs-string">&quot;@FeignClient can only be specified on an interface&quot;</span>);

                <span class="hljs-comment">// 获取 @FeignClient 注解的属性值</span>
                Map&lt;String, Object&gt; attributes = annotationMetadata
                        .getAnnotationAttributes(
                                FeignClient.class.getCanonicalName());

                <span class="hljs-comment">// 获取 clientName 的值，也就是在构造器的参数值</span>
                <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> getClientName(attributes);
                <span class="hljs-comment">// 同上一个方法最后调用的方法，注入 @FeignClient中的configuration对象到容器中，name：name.feignClientSpecification</span>
                registerClientConfiguration(registry, name, attributes.get(<span class="hljs-string">&quot;configuration&quot;</span>));

                <span class="hljs-comment">// 循环注入 @FeignClient 对象，name：className</span>
                registerFeignClient(registry,
                    annotationMetadata, <i class="conum" data-value="1"></i><b>(1)</b>
                    attributes); <i class="conum" data-value="2"></i><b>(2)</b>

            }
        }
    }
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>接口元数据（拿了个名字）
<details>
<summary class="title">Details</summary>
<div class="content">
<div class="imageblock">
<div class="content">
<img src="../_images/annotation-matedata.png" alt="annotation matedata">
</div>
</div>
</div>
</details></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td><code>@FeignClient</code> 注解的属性值
<details>
<summary class="title">Details</summary>
<div class="content">
<div class="imageblock">
<div class="content">
<img src="../_images/attributes.png" alt="attributes">
</div>
</div>
</div>
</details></td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">org.springframework.cloud.openfeign.FeignClientsRegistrar#registerFeignClient</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">registerFeignClient</span><span class="hljs-params">(BeanDefinitionRegistry registry, AnnotationMetadata annotationMetadata, Map&lt;String, Object&gt; attributes)</span> { <span class="hljs-comment">// 获取类名称</span>
    <span class="hljs-type">String</span> <span class="hljs-variable">className</span> <span class="hljs-operator">=</span> annotationMetadata.getClassName();
    <span class="hljs-comment">// BeanDefinitionBuilder的主要作用就是构建一个AbstractBeanDefinition,AbstractBeanDefinition类最终被构建成一个BeanDefinitionHolder然后注册到Spring中</span>
    <span class="hljs-comment">// 注意：beanDefinition类为FeignClientFactoryBean，故在Spring获取类的时候实际返回的是FeignClientFactoryBean类</span>
    <span class="hljs-type">BeanDefinitionBuilder</span> <span class="hljs-variable">definition</span> <span class="hljs-operator">=</span> BeanDefinitionBuilder
            .genericBeanDefinition(FeignClientFactoryBean.class);
    validate(attributes);
    <span class="hljs-comment">// 添加FeignClientFactoryBean的属性，</span>
    definition.addPropertyValue(<span class="hljs-string">&quot;url&quot;</span>, getUrl(attributes));
    definition.addPropertyValue(<span class="hljs-string">&quot;path&quot;</span>, getPath(attributes));
    <span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> getName(attributes);
    definition.addPropertyValue(<span class="hljs-string">&quot;name&quot;</span>, name);
    <span class="hljs-comment">// Feign 容器名称</span>
    <span class="hljs-type">String</span> <span class="hljs-variable">contextId</span> <span class="hljs-operator">=</span> getContextId(attributes);
    definition.addPropertyValue(<span class="hljs-string">&quot;contextId&quot;</span>, contextId);
    definition.addPropertyValue(<span class="hljs-string">&quot;type&quot;</span>, className);
    definition.addPropertyValue(<span class="hljs-string">&quot;decode404&quot;</span>, attributes.get(<span class="hljs-string">&quot;decode404&quot;</span>));
    definition.addPropertyValue(<span class="hljs-string">&quot;fallback&quot;</span>, attributes.get(<span class="hljs-string">&quot;fallback&quot;</span>));
    definition.addPropertyValue(<span class="hljs-string">&quot;fallbackFactory&quot;</span>, attributes.get(<span class="hljs-string">&quot;fallbackFactory&quot;</span>));
    definition.setAutowireMode(AbstractBeanDefinition.AUTOWIRE_BY_TYPE);

    <span class="hljs-comment">// 设置别名</span>
    <span class="hljs-type">String</span> <span class="hljs-variable">alias</span> <span class="hljs-operator">=</span> contextId + <span class="hljs-string">&quot;FeignClient&quot;</span>;
    <span class="hljs-type">AbstractBeanDefinition</span> <span class="hljs-variable">beanDefinition</span> <span class="hljs-operator">=</span> definition.getBeanDefinition();

    <span class="hljs-type">boolean</span> <span class="hljs-variable">primary</span> <span class="hljs-operator">=</span> (Boolean) attributes.get(<span class="hljs-string">&quot;primary&quot;</span>); <span class="hljs-comment">// has a default, won&#x27;t be</span>
                                                            <span class="hljs-comment">// null</span>

    beanDefinition.setPrimary(primary);

    <span class="hljs-type">String</span> <span class="hljs-variable">qualifier</span> <span class="hljs-operator">=</span> getQualifier(attributes);
    <span class="hljs-keyword">if</span> (StringUtils.hasText(qualifier)) {
        alias = qualifier;
    }

    <span class="hljs-comment">// 定义BeanDefinitionHolder，name是 Feign标记的className</span>
    <span class="hljs-type">BeanDefinitionHolder</span> <span class="hljs-variable">holder</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BeanDefinitionHolder</span>(beanDefinition, className,
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>[] { alias });
    <span class="hljs-comment">// 注入FeignClientFactoryBean</span>
    BeanDefinitionReaderUtils.registerBeanDefinition(holder, registry);
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="feignclientfactorybean"><a class="anchor" href="#feignclientfactorybean"></a>FeignClientFactoryBean</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>FeignClientFactoryBean</code> 实现了 <code>FactoryBean&lt;Object&gt;</code> 接口。</p>
</div>
<div class="paragraph">
<p>在注册 <code>FeignClientFactoryBean</code> 时，会把 <code>getObject()</code> 方法返回的对象注入到 Spring 容器中</p>
</div>
<div class="listingblock">
<div class="title">org.springframework.cloud.openfeign.FeignClientFactoryBean#getObject</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-meta">@Override</span>
<span class="hljs-keyword">public</span> Object <span class="hljs-title function_">getObject</span><span class="hljs-params">()</span> <span class="hljs-keyword">throws</span> Exception {
    <span class="hljs-comment">// 返回jdk动态代理，最终注入 Spring 容器的是每个 @FeignClient 标记接口的代理类</span>
    <span class="hljs-keyword">return</span> getTarget();
}</code></pre>
</div>
</div>
<div class="sect2">
<h3 id="gettarget"><a class="anchor" href="#gettarget"></a><code>getTarget()</code></h3>
<div class="openblock">
<div class="content">
<div class="listingblock">
<div class="title">org.springframework.cloud.openfeign.FeignClientFactoryBean#getTarget</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java">&lt;T&gt; T <span class="hljs-title function_">getTarget</span><span class="hljs-params">()</span> {
    <span class="hljs-comment">// FeignContext 容器，所有配置信息都丛这里取</span>
    <span class="hljs-comment">// 从 FeignAutoConfiguration 注入</span>
    <span class="hljs-type">FeignContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.applicationContext.getBean(FeignContext.class); <i class="conum" data-value="1"></i><b>(1)</b>
    Feign.<span class="hljs-type">Builder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> feign(context);

    <span class="hljs-comment">// 未指定 url 属性</span>
    <span class="hljs-keyword">if</span> (!StringUtils.hasText(<span class="hljs-built_in">this</span>.url)) {
        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">this</span>.name.startsWith(<span class="hljs-string">&quot;http&quot;</span>)) {
            <span class="hljs-built_in">this</span>.url = <span class="hljs-string">&quot;http://&quot;</span> + <span class="hljs-built_in">this</span>.name;
        }
        <span class="hljs-keyword">else</span> {
            <span class="hljs-built_in">this</span>.url = <span class="hljs-built_in">this</span>.name;
        }
        <span class="hljs-comment">// 格式化 url</span>
        <span class="hljs-built_in">this</span>.url += cleanPath();
        <span class="hljs-comment">// HystrixTargeter.target</span>
        <span class="hljs-comment">// url 是 name (服务名)，根据服务名去负载均衡</span>
        <span class="hljs-keyword">return</span> (T) loadBalance(builder, context,
                <span class="hljs-keyword">new</span> <span class="hljs-title class_">HardCodedTarget</span>&lt;&gt;(<span class="hljs-built_in">this</span>.type, <span class="hljs-built_in">this</span>.name, <span class="hljs-built_in">this</span>.url)); <i class="conum" data-value="2"></i><b>(2)</b>
    }
    <span class="hljs-comment">// 指定 url 属性（url协议头不是必须的)</span>
    <span class="hljs-keyword">if</span> (StringUtils.hasText(<span class="hljs-built_in">this</span>.url) &amp;&amp; !<span class="hljs-built_in">this</span>.url.startsWith(<span class="hljs-string">&quot;http&quot;</span>)) {
        <span class="hljs-built_in">this</span>.url = <span class="hljs-string">&quot;http://&quot;</span> + <span class="hljs-built_in">this</span>.url;
    }
    <span class="hljs-comment">// 格式化 url</span>
    <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.url + cleanPath();
    <span class="hljs-comment">// 获取 http client</span>
    <span class="hljs-type">Client</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> getOptional(context, Client.class); <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="hljs-keyword">if</span> (client != <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">if</span> (client <span class="hljs-keyword">instanceof</span> LoadBalancerFeignClient) {
            <span class="hljs-comment">// not load balancing because we have a url,</span>
            <span class="hljs-comment">// but ribbon is on the classpath, so unwrap</span>
            client = ((LoadBalancerFeignClient) client).getDelegate();
        }
        <span class="hljs-keyword">if</span> (client <span class="hljs-keyword">instanceof</span> FeignBlockingLoadBalancerClient) {
            <span class="hljs-comment">// not load balancing because we have a url,</span>
            <span class="hljs-comment">// but Spring Cloud LoadBalancer is on the classpath, so unwrap</span>
            client = ((FeignBlockingLoadBalancerClient) client).getDelegate();
        }
        builder.client(client);
    }
    <span class="hljs-type">Targeter</span> <span class="hljs-variable">targeter</span> <span class="hljs-operator">=</span> get(context, Targeter.class); <i class="conum" data-value="4"></i><b>(4)</b>
    <span class="hljs-comment">// DefaultTargeter.target()</span>
    <span class="hljs-comment">// url 是 @FeignClient 中指定的 URL</span>
    <span class="hljs-keyword">return</span> (T) targeter.target(<span class="hljs-built_in">this</span>, builder, context,
            <span class="hljs-keyword">new</span> <span class="hljs-title class_">HardCodedTarget</span>&lt;&gt;(<span class="hljs-built_in">this</span>.type, <span class="hljs-built_in">this</span>.name, url)); <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>注入 <code>FeignContext</code>，入口在 <code>FeignAutoConfiguration</code></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>如果配置了 Hystrix，执行此方法
<div class="listingblock">
<div class="title">org.springframework.cloud.openfeign.FeignClientFactoryBean#loadBalance</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-keyword">protected</span> &lt;T&gt; T <span class="hljs-title function_">loadBalance</span><span class="hljs-params">(Feign.Builder builder,
                            FeignContext context,
                            HardCodedTarget&lt;T&gt; target)</span> {
    <span class="hljs-type">Client</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> getOptional(context, Client.class);
    <span class="hljs-keyword">if</span> (client != <span class="hljs-literal">null</span>) {
        builder.client(client);
        <span class="hljs-type">Targeter</span> <span class="hljs-variable">targeter</span> <span class="hljs-operator">=</span> get(context, Targeter.class);
        <span class="hljs-keyword">return</span> targeter.target(
            <span class="hljs-built_in">this</span>, builder, context, target);
    }

    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(
        <span class="hljs-string">&quot;No Feign Client for loadBalancing defined. &quot;</span> +
            <span class="hljs-string">&quot;Did you forget to include &quot;</span> +
            <span class="hljs-string">&quot;spring-cloud-starter-netflix-ribbon?&quot;</span>);
}</code></pre>
</div>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>默认执行的方法</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td><code>get()</code> 和 <code>getOptional()</code> 都是从 Feign 容器中去获取需要的类。其中通过 <code>get()</code> 方法获取的类不能为空。
<div class="listingblock">
<div class="title">org.springframework.cloud.openfeign.FeignClientFactoryBean#get</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-keyword">protected</span> &lt;T&gt; T <span class="hljs-title function_">get</span><span class="hljs-params">(FeignContext context, Class&lt;T&gt; type)</span> {
    <span class="hljs-comment">// contextId 是容器名称，type 是要获取的类</span>
    <span class="hljs-type">T</span> <span class="hljs-variable">instance</span> <span class="hljs-operator">=</span> context.getInstance(<span class="hljs-built_in">this</span>.contextId, type);
    <span class="hljs-keyword">if</span> (instance == <span class="hljs-literal">null</span>) {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalStateException</span>(
                <span class="hljs-string">&quot;No bean found of type &quot;</span> + type + <span class="hljs-string">&quot; for &quot;</span> +
                <span class="hljs-built_in">this</span>.contextId);
    }
    <span class="hljs-keyword">return</span> instance;
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">org.springframework.cloud.openfeign.FeignClientFactoryBean#getOptional</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-keyword">protected</span> &lt;T&gt; T <span class="hljs-title function_">getOptional</span><span class="hljs-params">(FeignContext context,Class&lt;T&gt; type)</span> {
    <span class="hljs-keyword">return</span> context.getInstance(<span class="hljs-built_in">this</span>.contextId, type);
}</code></pre>
</div>
</div></td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="targeter-target"><a class="anchor" href="#targeter-target"></a><code>Targeter.target()</code></h3>
<div class="paragraph">
<p><code>Targeter</code> 接口有两个实现 <code>DefaultTargeter</code> 和 <code>HystrixTargeter</code>，根据是否配置熔断分开处理，最终都是执行 Feign.Builder 的 target方法。</p>
</div>
<div class="listingblock">
<div class="title">org.springframework.cloud.openfeign.DefaultTargeter</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DefaultTargeter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Targeter</span> {

    <span class="hljs-meta">@Override</span>
    <span class="hljs-keyword">public</span> &lt;T&gt; T <span class="hljs-title function_">target</span><span class="hljs-params">(FeignClientFactoryBean factory, Feign.Builder feign,
            FeignContext context, Target.HardCodedTarget&lt;T&gt; target)</span> {
        <span class="hljs-comment">// 最终执行 Feign.Builder 的 target方法</span>
        <span class="hljs-keyword">return</span> feign.target(target);
    }
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">org.springframework.cloud.openfeign.HystrixTargeter#target</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">HystrixTargeter</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Targeter</span> {

	<span class="hljs-meta">@Override</span>
	<span class="hljs-keyword">public</span> &lt;T&gt; T <span class="hljs-title function_">target</span><span class="hljs-params">(FeignClientFactoryBean factory, Feign.Builder feign, FeignContext context, Target.HardCodedTarget&lt;T&gt; target)</span> {
		<span class="hljs-comment">// 校验</span>
		<span class="hljs-keyword">if</span> (!(feign <span class="hljs-keyword">instanceof</span> feign.hystrix.HystrixFeign.Builder)) {
			<span class="hljs-keyword">return</span> feign.target(target);
		}

		feign.hystrix.HystrixFeign.<span class="hljs-type">Builder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> (feign.hystrix.HystrixFeign.Builder) feign;
		<span class="hljs-type">String</span> <span class="hljs-variable">name</span> <span class="hljs-operator">=</span> StringUtils.isEmpty(factory.getContextId()) ? factory.getName()
			: factory.getContextId();
		<span class="hljs-type">SetterFactory</span> <span class="hljs-variable">setterFactory</span> <span class="hljs-operator">=</span> getOptional(name, context, SetterFactory.class);
		<span class="hljs-keyword">if</span> (setterFactory != <span class="hljs-literal">null</span>) {
			builder.setterFactory(setterFactory);
		}
		<span class="hljs-comment">// fallback 熔断</span>
		Class&lt;?&gt; fallback = factory.getFallback();
		<span class="hljs-keyword">if</span> (fallback != <span class="hljs-keyword">void</span>.class) {
			<span class="hljs-keyword">return</span> targetWithFallback(name, context, target, builder, fallback);
		}
		<span class="hljs-comment">// fallbackFactory 熔断</span>
		Class&lt;?&gt; fallbackFactory = factory.getFallbackFactory();
		<span class="hljs-keyword">if</span> (fallbackFactory != <span class="hljs-keyword">void</span>.class) {
			<span class="hljs-keyword">return</span> targetWithFallbackFactory(name, context, target, builder,
				fallbackFactory);
		}

		<span class="hljs-keyword">return</span> feign.target(target);
	}

	<span class="hljs-keyword">private</span> &lt;T&gt; T <span class="hljs-title function_">targetWithFallbackFactory</span><span class="hljs-params">(String feignClientName, FeignContext context,
											Target.HardCodedTarget&lt;T&gt; target, HystrixFeign.Builder builder,
											Class&lt;?&gt; fallbackFactoryClass)</span> {
		FallbackFactory&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">T</span>&gt; fallbackFactory = (FallbackFactory&lt;? <span class="hljs-keyword">extends</span> <span class="hljs-title class_">T</span>&gt;) getFromContext(
			<span class="hljs-string">&quot;fallbackFactory&quot;</span>, feignClientName, context, fallbackFactoryClass,
			FallbackFactory.class);
		<span class="hljs-keyword">return</span> builder.target(target, fallbackFactory);
	}

	<span class="hljs-keyword">private</span> &lt;T&gt; T <span class="hljs-title function_">targetWithFallback</span><span class="hljs-params">(String feignClientName, FeignContext context,
									 Target.HardCodedTarget&lt;T&gt; target, HystrixFeign.Builder builder,
									 Class&lt;?&gt; fallback)</span> {
		<span class="hljs-type">T</span> <span class="hljs-variable">fallbackInstance</span> <span class="hljs-operator">=</span> getFromContext(<span class="hljs-string">&quot;fallback&quot;</span>, feignClientName, context,
			fallback, target.type());
		<span class="hljs-keyword">return</span> builder.target(target, fallbackInstance);
	}
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">feign.hystrix.HystrixFeign.Builder</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-keyword">public</span> &lt;T&gt; T <span class="hljs-title function_">target</span><span class="hljs-params">(Target&lt;T&gt; target, T fallback)</span> {
  <span class="hljs-keyword">return</span> build(fallback != <span class="hljs-literal">null</span> ? <span class="hljs-keyword">new</span> <span class="hljs-title class_">FallbackFactory</span>.Default&lt;T&gt;(fallback) : <span class="hljs-literal">null</span>).newInstance(target);
}

<span class="hljs-keyword">public</span> &lt;T&gt; T <span class="hljs-title function_">target</span><span class="hljs-params">(Target&lt;T&gt; target, FallbackFactory&lt;? extends T&gt; fallbackFactory)</span> {
  <span class="hljs-keyword">return</span> build(fallbackFactory).newInstance(target);
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="feigncontext"><a class="anchor" href="#feigncontext"></a>FeignContext</h2>
<div class="sectionbody">
<div class="paragraph">
<p><code>FeignContext</code> 继承自 <code>NamedContextFactory</code> ，实现为每个 <code>@FeignClient</code> 标记的接口创建单独的子容器。</p>
</div>
<div class="sect2">
<h3 id="初始化"><a class="anchor" href="#初始化"></a>初始化</h3>
<div class="paragraph">
<p><code>FeignContext</code> 由 <code>FeignAutoConfiguration</code> 在启动时注入，<code>FeignAutoConfiguration</code> 被 <code>EnableConfigurationProperties</code> 修饰，启用对 <code>@ConfigurationProperties</code> 注释Bean的支持。。</p>
</div>
<div class="listingblock">
<div class="title">org.springframework.cloud.openfeign.FeignAutoConfiguration</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-meta">@Configuration(proxyBeanMethods = false)</span>
<span class="hljs-meta">@ConditionalOnClass(Feign.class)</span>
<span class="hljs-meta">@EnableConfigurationProperties({FeignClientProperties.class, FeignHttpClientProperties.class })</span>
<span class="hljs-meta">@Import(DefaultGzipDecoderConfiguration.class)</span>
<span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FeignAutoConfiguration</span> {

    <span class="hljs-meta">@Autowired(required = false)</span>
    <span class="hljs-keyword">private</span> List&lt;FeignClientSpecification&gt; configurations = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> HasFeatures <span class="hljs-title function_">feignFeature</span><span class="hljs-params">()</span> {
        <span class="hljs-keyword">return</span> HasFeatures.namedFeature(<span class="hljs-string">&quot;Feign&quot;</span>, Feign.class);
    }

    <span class="hljs-meta">@Bean</span>
    <span class="hljs-keyword">public</span> FeignContext <span class="hljs-title function_">feignContext</span><span class="hljs-params">()</span> {
        <span class="hljs-comment">// 注入 FeignContext</span>
        <span class="hljs-type">FeignContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FeignContext</span>();
        context.setConfigurations(<span class="hljs-built_in">this</span>.configurations);
        <span class="hljs-keyword">return</span> context;
    }
    <span class="hljs-comment">//..</span>
}</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">org.springframework.cloud.openfeign.FeignContext#FeignContext</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FeignContext</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">NamedContextFactory</span>&lt;FeignClientSpecification&gt; {

    <span class="hljs-keyword">public</span> <span class="hljs-title function_">FeignContext</span><span class="hljs-params">()</span> {
		<span class="hljs-comment">// FeignClientsConfiguration 是 Feign的默认全局配置</span>
        <span class="hljs-built_in">super</span>(FeignClientsConfiguration.class, <span class="hljs-string">&quot;feign&quot;</span>, <span class="hljs-string">&quot;feign.client.name&quot;</span>);
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>通过调用父类的 <code>getInstance</code> 方法返回容器中的 <code>Bean</code>。</p>
</div>
<div class="listingblock">
<div class="title">org.springframework.cloud.context.named.NamedContextFactory#getInstance</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-keyword">public</span> &lt;T&gt; T <span class="hljs-title function_">getInstance</span><span class="hljs-params">(String name, Class&lt;T&gt; type)</span> {
    <span class="hljs-comment">// 先判断内存中有没有，有直接返回，没有会创建一个</span>
    <span class="hljs-comment">// 所有子容器保存在一个 ConcurrentHashMap 中</span>
    <span class="hljs-type">AnnotationConfigApplicationContext</span> <span class="hljs-variable">context</span> <span class="hljs-operator">=</span> getContext(name);
    <span class="hljs-keyword">if</span> (BeanFactoryUtils.beanNamesForTypeIncludingAncestors(context,
            type).length &gt; <span class="hljs-number">0</span>) {
        <span class="hljs-keyword">return</span> context.getBean(type);
    }
    <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="调用"><a class="anchor" href="#调用"></a>调用</h3>
<div class="paragraph">
<p><code>FeignClientFactoryBean</code> 中创建 <code>Feign.Builder</code> 和给 <code>Feign.Builder</code> 设置属性时调用，根据名字从中 <code>ApplicationContext</code> 获取 <code>FeignContext</code> 子容器。</p>
</div>
<div class="listingblock">
<div class="title">org.springframework.cloud.openfeign.FeignClientFactoryBean</div>
<div class="content">
<pre class="highlight"><code class="language-java" data-lang="java"><span class="hljs-keyword">protected</span> Feign.Builder <span class="hljs-title function_">feign</span><span class="hljs-params">(FeignContext context)</span> {
    <span class="hljs-type">FeignLoggerFactory</span> <span class="hljs-variable">loggerFactory</span> <span class="hljs-operator">=</span> get(context, FeignLoggerFactory.class);
    <span class="hljs-type">Logger</span> <span class="hljs-variable">logger</span> <span class="hljs-operator">=</span> loggerFactory.create(<span class="hljs-built_in">this</span>.type);

    <span class="hljs-comment">// build()设置默认值</span>
    Feign.<span class="hljs-type">Builder</span> <span class="hljs-variable">builder</span> <span class="hljs-operator">=</span> get(context, Feign.Builder.class)
            <span class="hljs-comment">// required values</span>
            .logger(logger)
            .encoder(get(context, Encoder.class))
            .decoder(get(context, Decoder.class))
            .contract(get(context, Contract.class));

    configureFeign(context, builder);

    <span class="hljs-keyword">return</span> builder;
}

<span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">configureUsingConfiguration</span><span class="hljs-params">(FeignContext context,
                                           Feign.Builder builder)</span> {
    Logger.<span class="hljs-type">Level</span> <span class="hljs-variable">level</span> <span class="hljs-operator">=</span> getOptional(context, Logger.Level.class);
    <span class="hljs-keyword">if</span> (level != <span class="hljs-literal">null</span>) {
        builder.logLevel(level);
    }
    <span class="hljs-type">Retryer</span> <span class="hljs-variable">retryer</span> <span class="hljs-operator">=</span> getOptional(context, Retryer.class);
    <span class="hljs-keyword">if</span> (retryer != <span class="hljs-literal">null</span>) {
        builder.retryer(retryer);
    }
    <span class="hljs-type">ErrorDecoder</span> <span class="hljs-variable">errorDecoder</span> <span class="hljs-operator">=</span> getOptional(context, ErrorDecoder.class);
    <span class="hljs-keyword">if</span> (errorDecoder != <span class="hljs-literal">null</span>) {
        builder.errorDecoder(errorDecoder);
    }
    Request.<span class="hljs-type">Options</span> <span class="hljs-variable">options</span> <span class="hljs-operator">=</span> getOptional(context, Request.Options.class);
    <span class="hljs-keyword">if</span> (options != <span class="hljs-literal">null</span>) {
        builder.options(options);
    }
    Map&lt;String, RequestInterceptor&gt; requestInterceptors = context
        .getInstances(<span class="hljs-built_in">this</span>.contextId, RequestInterceptor.class);
    <span class="hljs-keyword">if</span> (requestInterceptors != <span class="hljs-literal">null</span>) {
        builder.requestInterceptors(requestInterceptors.values());
    }
    <span class="hljs-type">QueryMapEncoder</span> <span class="hljs-variable">queryMapEncoder</span> <span class="hljs-operator">=</span> getOptional(context, QueryMapEncoder.class);
    <span class="hljs-keyword">if</span> (queryMapEncoder != <span class="hljs-literal">null</span>) {
        builder.queryMapEncoder(queryMapEncoder);
    }
    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.decode404) {
        builder.decode404();
    }
}</code></pre>
</div>
</div>
</div>
</div>
</div>
<nav class="pagination">
  <span class="prev"><a href="../feign/feign-core.html">Feign 的核心流程</a></span>
  <span class="next"><a href="spring-mvc-support.html">SpringMVC 注解支持原理</a></span>
</nav>
</article>
  </div>
</main>
</div>
<!--<footer class="footer">
  <p>This page was built using the Antora default UI.</p>
  <p>The source code for this UI is licensed under the terms of the MPL-2.0 license.</p>
</footer>
-->
<script id="site-script" src="../../_/js/site.js" data-ui-root-path="../../_"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
<script src="../../_/js/vendor/lunr.js"></script>
<script src="../../_/js/search-ui.js" id="search-ui-script" data-site-root-path="../.." data-snippet-length="100" data-stylesheet="../../_/css/search.css"></script>
<script async src="../../search-index.js"></script>
  </body>
</html>
